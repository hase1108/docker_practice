# DockerFile入門

## DockerFfileとは

今までは開発などに利用するDockerコンテナを作成するにあたり、各種設定などを一々コマンドラインに入力して行っていた。  
しかし、一連の手順をコマンドラインのみで行うのはコマンドの入力ミスなどが起こりやすく、そもそも効率が悪い。  
そこでDockerでは``Dockerfile``と呼ばれるファイルに各種命令を記述することで、自動的に望みのコンテナを作成することができる仕組みが存在する。  
本章では具体的にapacheが稼働するコンテナのためのDockerfileを記述することを通じてDockerfileについて学ぶ。

## Apacheコンテナの作成

まずはDockerfileを作成する。  
基本的にDockerfileはどこに作成しても良いが、後述する**ビルドコンテキスト**との兼ね合いがあるため、自身の階層以下にディレクトリが存在しないような場所に作成する。  
今回作成するDockerfileは以下のようになる。

```
FROM centos:latest (1)
RUN yum install -y httpd iproute && yum clean all (2)
RUN echo "Hello Apache." > /var/www/html/index.html (3)
ENTRYPOINT [ "/usr/sbin/httpd","-DFOREGROUND"] (4)
```

|項番|概要|
|:--|:--|
|1|親イメージとしてcentosを指定|
|2|httpd(apache)をイメージ内で利用できるように指定|
|3|apcheのindexページに使用するファイルをコンテナ内の所定の場所に書き込む|
|4|コンテナ起動時にhttpdをforegroundで実行する命令をコンテナ内で行うように指定|

これを``Dockerfile``というファイル名で適当なディレクトリに保存し、そのディレクトリ階層で以下のコマンドを実行することでイメージをビルドする。  

``docker build -t centos:apache .``

コマンドラインに各種情報が流れるが、``docker images``でcentos:apacheが存在すればビルドは成功している。  

以下のコマンドを実行し、コンテナを起動する。
``docker run -itd -p 8081:80 centos:apache``

ブラウザなどで、``http://127.0.0.1:8081/index.html``にアクセスし、**Hello Apache**が表示されれば成功である。

### イメージのビルド

Dockerfileの構造の前にまずはDockerにおけるビルドに関して解説する。  
ビルドする際はdocker buildコマンドに**コンテキスト(パス or URL)**と**Dockerfile**の情報を付与して行う。  

コンテキストはDockerのビルドに必要なファイルが存在するパスやURLを示し、通常コンテキストで指定されたパスorURLをルートディレクトリとして、その配下のディレクトリ、ファイルを**全て**Dockerデーモンに送信してビルドを行う。  
今回のビルドは今回では``docker build -t centos:apache .``というコマンドを実行して行っているが、この場合、コンテキストは``.``つまり現在のディレクトリを指定している。  
また、Dockerfileの情報を与えていないが、オプションなどで指定しない場合、コンテキストのルートディレクトリに保存されている``Dockerfile``という名称のファイルを探して自動的に使用する。  
Dockerfileを別の名称やディレクトリなどに保存して利用したい場合は``-f``オプションを利用することができる。  

注意点として、前述したようにコンテキストは基本的に**指定した場所以下のディレクトリファイルを全てDockerデーモンに送信する**ため、コンテキスト配下に不要なファイルなどが多量に含まれている場合、イメージのビルドに非常に時間がかかる可能性がある。

#### .dockerignore

コンテキスト配下にデーモンに対して送信してほしくないファイルが存在する場合、コンテキストルートに``.dockerignore``ファイルを作成し、送信したくないファイルを記述することで実現できる。  
ファイルの中身は``.gitignore``と同じように除外したファイルやディレクトリを記述する。

### Dockerfileの構造

Dockerfileは前述のようにイメージを作成するための命令を記述するが、記述方法には当然ルールがある。  
